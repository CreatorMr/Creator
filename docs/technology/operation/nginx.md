---
tags: 
- nginx
date: 2020-04-13
categories: 
- "运维"
---
# nginx
# Nginx

<a name="44aea6b6"></a>
### 1、模块与基本配置
<a name="5c3bdda8"></a>
### 2、正向、反向代理以及应用场景
<a name="54032f63"></a>
### 3、CDN
<a name="3c2ebd31"></a>
### 4、浏览器缓存
<a name="dbf5d0b8"></a>
### 5、跨域、防盗链


参考[https://juejin.im/post/5c85a64d6fb9a04a0e2e038c#heading-19](https://juejin.im/post/5c85a64d6fb9a04a0e2e038c#heading-19)

- 解决跨域
- 请求过滤
- 配置gzip
- 负载均衡
- 静态资源服务器
- ...

nginx 在使用的过程中大部分是使用它的代理功能。那么什么是代理？<br />代理：在客户端和服务端中间的一层服务器。负责在客户端和服务端的做转发，把客户端的请求转发到服务端，把服务端的响应转发给客户端。<br />正向代理与反向代理：<br />**正向代理**，意思是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端

** 反向代理**（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。

**正向代理**是为我们服务的，即为客户端服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。<br />**正向代理**对我们是透明的，对服务端是非透明的，即服务端并不知道自己收到的是来自代理的访问还是来自真实客户端的访问

<br />**反向代理**是为服务端服务的，反向代理可以帮助服务器接收来自客户端的请求，帮助服务器做请求转发，负载均衡等。<br />**反向代理**对服务端是透明的，对我们是非透明的，即我们并不知道自己访问的是代理服务器，而服务器知道反向代理在为他服务。


```
复制代码
http 
{
    server
    { 
        location path
        {
            ...
        }
        location path
        {
            ...
        }
     }

    server
    {
        ...
    }

}

链接：https://juejin.im/post/5c85a64d6fb9a04a0e2e038c

```

- `main`:nginx的全局配置，对全局生效。
- `events`:配置影响nginx服务器或与用户的网络连接。
- `http`：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。
- `server`：配置虚拟主机的相关参数，一个http中可以有多个server。
- `location`：配置请求的路由，以及各种页面的处理情况。
- `upstream`：配置后端服务器具体地址，负载均衡配置不可或缺的部分。



| 变量名 | 功能 |
| --- | --- |
| `$host` | 请求信息中的`Host`，如果请求中没有`Host`行，则等于设置的服务器名 |
| `$request_method` | 客户端请求类型，如`GET`、`POST` |
| `$remote_addr` | 客户端的`IP`地址 |
| `$args` | 请求中的参数 |
| `$content_length` | 请求头中的`Content-length`字段 |
| `$http_user_agent` | 客户端agent信息 |
| `$http_cookie` | 客户端cookie信息 |
| `$remote_port` | 客户端的端口 |
| `$server_protocol` | 请求使用的协议，如`HTTP/1.0`、·HTTP/1.1` |
| `$server_addr` | 服务器地址 |
| `$server_name` | 服务器名称 |
| `$server_port` | 服务器的端口号 |

负载均衡：轮询、最小连接数、最快响应时间、客户端绑定IP<br />ip_hash记录上次访问的哪台服务器
